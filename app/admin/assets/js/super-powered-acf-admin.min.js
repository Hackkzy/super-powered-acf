(d=>{acf.addAction("ready",function(){e=d("<div>",{id:"sup-acf-modal",class:"sup-acf-modal",role:"dialog","aria-labelledby":"sup-acf-modal-title","aria-modal":"true"}),a=d("<div>",{class:"sup-acf-modal-header"}).append(d("<h2>",{id:"sup-acf-modal-title",class:"sup-acf-modal-title",text:sup_acf.i18n.modalTitle})).append(d("<button>",{id:"sup-acf-generate-cancel",class:"sup-acf-close-button","aria-label":"Close modal"}).append(d("<span>",{"aria-hidden":"true",text:"Ã—"}))),s=d("<div>",{class:"sup-acf-modal-content"}).append(d("<label>",{for:"sup-acf-prompt",text:sup_acf.i18n.promptLabel})).append(d("<textarea>",{id:"sup-acf-prompt",class:"sup-acf-textarea",placeholder:sup_acf.i18n.promptPlaceholder,"aria-describedby":"sup-acf-prompt-help sup-acf-ai-note"})).append(d("<p>",{id:"sup-acf-prompt-help",class:"sup-acf-help-text",text:sup_acf.i18n.promptHelp})).append(d("<p>",{id:"sup-acf-ai-note",class:"sup-acf-note"}).append(d("<span>",{class:"dashicons dashicons-info"})).append(sup_acf.i18n.aiNote)),p=d("<div>",{class:"sup-acf-modal-actions"}).append(d("<button>",{id:"sup-acf-generate-confirm",class:"acf-btn acf-btn-primary sup-acf-modal-button",text:sup_acf.i18n.generateFields})),n=d("<div>",{id:"sup-acf-loading",class:"sup-acf-loading",style:"display:none;"}).append(d("<div>",{class:"sup-acf-spinner",role:"status","aria-label":sup_acf.i18n.generatingFields})).append(d("<p>",{text:sup_acf.i18n.generatingFields})),t=d("<div>",{id:"sup-acf-error",class:"sup-acf-error",style:"display:none;",role:"alert"}),e.append(a).append(s.append(p).append(n).append(t)),a=d("<div>",{id:"sup-acf-modal-overlay",class:"sup-acf-modal-overlay"});var e,a,t,{$modal:s,$overlay:p}={$modal:e,$overlay:a},n=(d("body").append(s).append(p),d("<button>",{id:"sup-acf-generate-fields-btn",class:"acf-btn acf-btn-secondary",text:sup_acf.i18n.generateWithAI}));function i(){let e=d("#sup-acf-modal"),a=d("#sup-acf-modal-overlay");e.removeClass("is-visible"),a.removeClass("is-visible"),setTimeout(()=>{e.hide(),a.hide(),d("#sup-acf-prompt").val(""),d("#sup-acf-error").hide(),d("#sup-acf-generate-fields-btn").focus()},300)}function c(e){var a=d("#sup-acf-error");a.html(e).hide().fadeIn(300),d("#sup-acf-loading").hide(),d(".sup-acf-modal-button").prop("disabled",!1),a.attr("role","alert")}function l(p){if(p&&"object"==typeof p&&p.label&&"string"==typeof p.label&&p.type&&"string"==typeof p.type){let s=d(".acf-field-list:first");var e=d("#tmpl-acf-field");if(e.length){var e=e.html(),e=d(e),a=e.data("id"),n=acf.uniqid("field_");let t=acf.duplicate({target:e,search:a,replace:n,append:(e,a)=>s.append(a)});e=acf.getFieldObject(t);e.prop("key",n),e.prop("ID",0),e.prop("label",p.label),e.prop("name",p.name||n),e.prop("instructions",p.instructions||""),t.attr("data-key",n).attr("data-id",n),t.find(".acf-field-label input").val(p.label),t.find(".acf-field-name input").val(p.name||n),t.find(".field-type").val(p.type).trigger("change"),setTimeout(()=>{var e,a;"select"===p.type&&p.choices&&(e=t.find(".acf-field-setting-choices textarea")).length&&(a=Object.entries(p.choices).map(([e,a])=>e+" : "+a).join("\n"),e.val(a).trigger("input")),p.required&&t.find(".acf-field-setting-required input").prop("checked",!0).trigger("change")},1500),a=s,(e=acf.getFieldObjects({list:a})).length?(a.removeClass("-empty").parents(".acf-field-list-wrap").first().removeClass("-empty"),e.forEach((e,a)=>e.prop("menu_order",a))):a.addClass("-empty").parents(".acf-field-list-wrap").first().addClass("-empty")}else console.error("ACF field template not found.")}}d(".acf-headerbar-actions").append(n),d(document).on("click","#sup-acf-generate-fields-btn",function(){var e=d("#sup-acf-modal"),a=d("#sup-acf-modal-overlay");e.show(),a.show(),e[0].offsetHeight,a[0].offsetHeight,e.addClass("is-visible"),a.addClass("is-visible"),d("#sup-acf-prompt").focus(),d("#sup-acf-error").hide(),(e=>{let a=e.find('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])').toArray(),t=a[0],s=a[a.length-1];e.on("keydown",function(e){"Tab"===e.key&&(e.shiftKey?document.activeElement===t&&(e.preventDefault(),s.focus()):document.activeElement===s&&(e.preventDefault(),t.focus()))})})(e)}),d(document).on("click","#sup-acf-generate-cancel",i),d(document).on("click","#sup-acf-generate-confirm",function(){let e=d("#sup-acf-prompt"),a=e.val().trim();a?(d("#sup-acf-error").hide(),d("#sup-acf-loading").hide().fadeIn(300),d(".sup-acf-modal-button").prop("disabled",!0),d.ajax({url:sup_acf.root+"sup-acf/v1/generate-fields",type:"POST",contentType:"application/json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",sup_acf.nonce)},data:JSON.stringify({prompt:a}),success:function(e){d("#sup-acf-loading").hide(),d(".sup-acf-modal-button").prop("disabled",!1),e.success&&e.fields&&e.fields.length?(e.fields.forEach(l),i()):c(sup_acf.i18n.noFieldsGenerated)},error:function(e){e=e.responseJSON;c(e&&e.message?e.message:sup_acf.i18n.genericError)}})):(e.focus(),c(sup_acf.i18n.enterPrompt))}),d(document).on("keydown",function(e){"Escape"===e.key&&d("#sup-acf-modal").is(":visible")&&i()})})})(jQuery);